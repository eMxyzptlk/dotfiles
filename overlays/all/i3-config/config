#################
# Core settings #
#################

# variables

set $mod Mod4
set $alt Mod1
set $nosid --no-startup-id
set $locker @xautolock_bin@ -locknow && sleep 1

# Colors
# class                   border  backgr. text    indicator
client.focused            #5f865f #5f865f #e4e4e4 #ffafaf
client.focused_inactive   #4e4e4e #4e4e4e #d0d0d0 #ffafaf
client.unfocused          #4e4e4e #4e4e4e #87d7d7 #87af87
client.urgent             #ff0000 #ff0000 #e4e4e4 #d68787

# keep the urgency border of a window for 500ms
force_display_urgency_hint 500 ms

# This option determines in which mode new containers on workspace level will
# start.
workspace_layout tabbed

############
# Bindings #
############


################
# Applications #
################

#########
# Modes #
#########

# Daemon launcher
set $mode_daemon Launch: (x) Xcape, (g) Greenclip
mode "$mode_daemon" {
	bindsym x exec $nosid @xcape_bin@ -e 'Control_L=Escape', mode "default"
	bindsym g exec $nosid @greenclip_bin@ daemon, mode "default"

	# back to normal: Enter or Escape
	bindsym Return mode "default"
	bindsym Escape mode "default"
}
bindsym $mod+$alt+l mode "$mode_daemon"

# Window Manager mode, this mode allows me to control i3
set $mode_wm WM: (r) Reload i3, (e) Restart i3
mode "$mode_wm" {
	bindsym r reload; exec $nosid @notify-send_bin@ 'i3 configuration reloaded', mode "default"
	bindsym e restart; exec $nosid @notify-send_bin@ 'i3 restarted', mode "default"

	# back to normal: Enter or Escape
	bindsym Return mode "default"
	bindsym Escape mode "default"
}
bindsym $mod+$alt+w mode "$mode_wm"

# Application launcher
set $mode_apps Launch: (p) Chromium personal, (u) Chromium publica, (c) Charles, (s) Slack, (i) Irc, (w) Whatsapp, (t) Teamviewer, (m) Pulse SMS
mode "$mode_apps" {
	bindsym p exec @rbrowser_bin@ --profile personal, mode "default"
	bindsym u exec @rbrowser_bin@ --profile publica, mode "default"
	bindsym c exec @charles_bin@, mode "default"
	bindsym s exec @slack_bin@, mode "default"
	bindsym i exec @alacritty_bin@ --title=irc --exec=weechat, mode "default"
	# TODO: install this
	# bindsym w exec whatsapp-web-desktop, mode "default"
	# TODO: is this still necessary?
	#bindsym t exec myteamviewer, mode "default"
	# TODO: install Pulse and use the binary here
	#bindsym m exec $nosid /opt/Pulse\ SMS/pulse-sms, mode "default"

	# back to normal: Enter or Escape
	bindsym Return mode "default"
	bindsym Escape mode "default"
}
bindsym $mod+$alt+a mode "$mode_apps"

# resize window (you can also use the mouse for that)
set $resize_mode resize
mode "$resize_mode" {
	# Micro resizement
	bindsym Control+n resize shrink width 10 px or 1 ppt
	bindsym Control+e resize grow height 10 px or 1 ppt
	bindsym Control+i resize shrink height 10 px or 1 ppt
	bindsym Control+o resize grow width 10 px or 1 ppt

	# Normal resizing
	bindsym n resize shrink width 50 px or 5 ppt
	bindsym e resize grow height 50 px or 5 ppt
	bindsym i resize shrink height 50 px or 5 ppt
	bindsym o resize grow width 50 px or 5 ppt

	# Macro resizing
	bindsym Shift+n resize shrink width 100 px or 10 ppt
	bindsym Shift+e resize grow height 100 px or 10 ppt
	bindsym Shift+i resize shrink height 100 px or 10 ppt
	bindsym Shift+o resize grow width 100 px or 10 ppt

	# back to normal: Enter or Escape
	bindsym Return mode "default"
	bindsym Escape mode "default"
}
bindsym $mod+$alt+r mode "$resize_mode"

# move window (you can also use the mouse for that)
set $move_mode move
mode "$move_mode" {
	# Micro movement
	bindsym Control+n move left 10 px
	bindsym Control+e move down 10 px
	bindsym Control+i move up 10 px
	bindsym Control+o move right 10 px

	# Normal resizing
	bindsym n move left 50 px
	bindsym e move down 50 px
	bindsym i move up 50 px
	bindsym o move right 50 px

	# Macro resizing
	bindsym Shift+n move left 100 px
	bindsym Shift+e move down 100 px
	bindsym Shift+i move up 100 px
	bindsym Shift+o move right 100 px

	# back to normal: Enter or Escape
	bindsym Return mode "default"
	bindsym Escape mode "default"
}
bindsym $mod+$alt+m mode "$move_mode"

# Display mode allows output/resolution selection
set $mode_display (l) Laptop screen, (m) Multiple screen, (w) Wide screen
mode "$mode_display" {
	bindsym l exec $nosid @xrandr_bin@ --output @int_monitor@ --mode @int_mode@ --scale @int_scale@ --output @ext_monitor@ --off, mode "default"
	bindsym m exec $nosid @xrandr_bin@ --output @int_monitor@ --mode @int_mode@ --scale @int_scale@ --output @ext_monitor@ --primary --mode 3440x1440 --right-of @int_monitor@, mode "default"
	bindsym w exec $nosid @xrandr_bin@ --output @int_monitor@ --off --output @ext_monitor@ --mode 3440x1440, mode "default"

	# back to normal: Enter or Escape
	bindsym Return mode "default"
	bindsym Escape mode "default"
}
bindsym $mod+$alt+d mode "$mode_display"

## Management of power
set $mode_power System: (l) lock, (o) logout, (s) suspend, (h) hibernate, (r) reboot, (Shift+s) shutdown
mode "$mode_power" {
	bindsym l exec $nosid $locker, mode "default"
	bindsym o exit
	bindsym s exec $nosid $locker && systemctl suspend, mode "default"
	bindsym h exec $nosid $locker && systemctl hibernate, mode "default"
	bindsym r exec $nosid systemctl reboot
	bindsym Shift+s exec $nosid systemctl poweroff -i

	# back to normal: Enter or Escape
	bindsym Return mode "default"
	bindsym Escape mode "default"
}
bindsym $mod+$alt+p mode "$mode_power"

# CPU governor selection
set $mode_cpugovernor CPU Scaling governor: (p) Performance, (o) Powersave
mode "$mode_cpugovernor" {
	bindsym p exec $nosid @gksudo_bin@ -- @cpupower_bin@ frequency-set --governor performance, mode "default"
	bindsym o exec $nosid @gksudo_bin@ -- @cpupower_bin@ frequency-set --governor powersave, mode "default"

	# back to normal: Enter or Escape
	bindsym Return mode "default"
	bindsym Escape mode "default"
}
bindsym $mod+$alt+g mode "$mode_cpugovernor"

#######
# Bar #
#######

# Start i3bar to display a workspace bar (plus the system information i3status
# finds out, if available)
bar {
	# put the bar on the top
	position top
	# use i3status for the bar
	status_command @i3status_bin@
	# disable clicking on workspace buttons
	bindsym button1 nop

	# setup colors
	colors {
		separator #d68787
		background #626262
		statusline #00ff00
		focused_workspace #e4e4e4 #5f865f #e4e4e4
		active_workspace #e4e4e4 #ffafaf #e4e4e4
		inactive_workspace #87af87 #87d7d7 #626262
		urgent_workspace #ff0000 #ff0000 #e4e4e4
	}
}

##########################
# Application assignment #
##########################

########################
# Workspace assignment #
########################

# assign important spaces to my external monitor
workspace personal@base output @ext_monitor@
workspace publica@base output @ext_monitor@
workspace irc output @ext_monitor@
workspace mail output @ext_monitor@

# assign side apps to the laptop
workspace media output @int_monitor@

######################
# Scratchpad support #
######################

# Make the currently focused window a scratchpad
bindsym $mod+Shift+minus move scratchpad

# Make the currently focused window a scratchpad
bindsym $mod+$alt+minus scratchpad show

# Whatsapp
for_window [class="^whats-app-nativefier*"] sticky enable, floating enable, move scratchpad
bindsym $alt+w [class="^whats-app-nativefier*"] scratchpad show

# Pulse
for_window [class="pulse-sms"] sticky enable, floating enable, move scratchpad
bindsym $alt+p [class="pulse-sms"] scratchpad show

##############
# Auto Start #
##############

# set the correct delay and repeat
exec $nosid @xset_bin@ r rate 300 30

# start xcape, I love xcape!
exec $nosid @xcape_bin@ -e 'Control_L=Escape'

# start the greenclip daemon
exec $nosid @greenclip_bin@ daemon

# Start the personal terminal on the personal workspace
exec i3-msg "workspace personal@base; exec $nosid @alacritty_bin@"
